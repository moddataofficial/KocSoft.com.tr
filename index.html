<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Süper Tank Arena</title>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; cursor: crosshair; }
        canvas { display: block; }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const keys = {};
const mouse = { x: 0, y: 0 };
let particles = [];
let screenShake = 0;

// Tank Nesnesi
const tank = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    bodyAngle: 0,
    turretAngle: 0,
    speed: 0,
    maxSpeed: 3.5,
    accel: 0.1,
    friction: 0.05,
    rotateSpeed: 0.04,
    bullets: []
};

// Partikül Oluşturucu (Patlama ve Duman için)
function createExplosion(x, y, color, count = 10) {
    for (let i = 0; i < count; i++) {
        particles.push({
            x, y,
            vx: (Math.random() - 0.5) * 6,
            vy: (Math.random() - 0.5) * 6,
            life: 1.0,
            color: color
        });
    }
}

window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
window.addEventListener('mousedown', () => {
    // Ateş Etme
    tank.bullets.push({
        x: tank.x + Math.cos(tank.turretAngle) * 35,
        y: tank.y + Math.sin(tank.turretAngle) * 35,
        angle: tank.turretAngle,
        speed: 10,
        bounces: 0,
        maxBounces: 3
    });
    screenShake = 6;
    createExplosion(tank.x + Math.cos(tank.turretAngle) * 35, tank.y + Math.sin(tank.turretAngle) * 35, '#ffae00', 5);
});

function update() {
    // Tank Hareketi
    if (keys['w']) tank.speed = Math.min(tank.speed + tank.accel, tank.maxSpeed);
    else if (keys['s']) tank.speed = Math.max(tank.speed - tank.accel, -tank.maxSpeed/2);
    else {
        tank.speed *= (1 - tank.friction);
        if (Math.abs(tank.speed) < 0.01) tank.speed = 0;
    }

    if (keys['a']) tank.bodyAngle -= tank.rotateSpeed;
    if (keys['d']) tank.bodyAngle += tank.rotateSpeed;

    tank.x += Math.cos(tank.bodyAngle) * tank.speed;
    tank.y += Math.sin(tank.bodyAngle) * tank.speed;
    tank.turretAngle = Math.atan2(mouse.y - tank.y, mouse.x - tank.x);

    // Mermi Güncelleme ve Sekme
    tank.bullets.forEach((b, i) => {
        b.x += Math.cos(b.angle) * b.speed;
        b.y += Math.sin(b.angle) * b.speed;

        // Duvarlardan Sekme Mantığı
        if (b.x < 0 || b.x > canvas.width) {
            b.angle = Math.PI - b.angle;
            b.bounces++;
            createExplosion(b.x, b.y, '#fff', 3);
        }
        if (b.y < 0 || b.y > canvas.height) {
            b.angle = -b.angle;
            b.bounces++;
            createExplosion(b.x, b.y, '#fff', 3);
        }

        if (b.bounces > b.maxBounces) {
            createExplosion(b.x, b.y, '#ff4400', 8);
            tank.bullets.splice(i, 1);
        }
    });

    // Partikülleri Güncelle
    particles.forEach((p, i) => {
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 0.02;
        if (p.life <= 0) particles.splice(i, 1);
    });

    if (screenShake > 0) screenShake *= 0.9;
}

function draw() {
    ctx.fillStyle = '#222';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.save();
    if (screenShake > 0.5) ctx.translate(Math.random()*screenShake, Math.random()*screenShake);

    // Partikülleri Çiz
    particles.forEach(p => {
        ctx.globalAlpha = p.life;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, 2, 0, Math.PI*2);
        ctx.fill();
    });

    // Mermileri Çiz
    ctx.globalAlpha = 1;
    tank.bullets.forEach(b => {
        ctx.fillStyle = '#ff0';
        ctx.beginPath();
        ctx.arc(b.x, b.y, 4, 0, Math.PI*2);
        ctx.fill();
        // Mermi İzi
        ctx.strokeStyle = 'rgba(255, 255, 0, 0.3)';
        ctx.lineWidth = 2;
        ctx.lineTo(b.x - Math.cos(b.angle)*10, b.y - Math.sin(b.angle)*10);
        ctx.stroke();
    });

    // Tank Çizimi (Gövde)
    ctx.save();
    ctx.translate(tank.x, tank.y);
    ctx.rotate(tank.bodyAngle);
    ctx.fillStyle = '#4a5d23';
    ctx.fillRect(-20, -15, 40, 30); // Gövde
    ctx.fillStyle = '#333';
    ctx.fillRect(-22, -18, 44, 6); // Sol Palet
    ctx.fillRect(-22, 12, 44, 6);  // Sağ Palet
    ctx.restore();

    // Tank Çizimi (Kule)
    ctx.save();
    ctx.translate(tank.x, tank.y);
    ctx.rotate(tank.turretAngle);
    ctx.fillStyle = '#5d752d';
    ctx.fillRect(-10, -10, 20, 20); // Kule
    ctx.fillStyle = '#111';
    ctx.fillRect(10, -3, 25, 6);   // Namlu
    ctx.restore();

    ctx.restore();
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
